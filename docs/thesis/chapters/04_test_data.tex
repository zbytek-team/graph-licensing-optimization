\chapter{Dane testowe}
 W celu przeprowadzenia szczegółowej analizy efektywności algorytmów optymalizujących zakup licencji w sieciach społecznościowych niezbędne jest wykorzystanie różnorodnych danych testowych. Posłużą do tego syntetycznie generowane grafy losowe oraz rzeczywiste fragmenty sieci społecznościowej. Pierwsza grupa stanowi kontrolowany zbiór danych sztucznych, pozwalający na symulowanie różnych scenariuszy topologicznych i analizę wpływu struktury sieci na działanie algorytmów. Druga grupa to rzeczywiste ego-sieci z platformy Facebook, umożliwiające weryfikację metod na prawdziwych danych społecznościowych.

\section{Grafy syntetyczne}

Do generowania danych syntetycznych wykorzystano zaimplementowaną w ramach pracy klasę \texttt{GraphGeneratorFactory}, która umożliwia tworzenie losowych grafów o zadanych parametrach przy użyciu różnych popularnych modeli generowania sieci. W szczególności obsługiwane są generatory takie jak model Erd\H{o}s-Rényi, Barabási-Albert oraz Watts-Strogatz.

\subsection{Model Erd\H{o}s-Rényi - klasyczne grafy przypadkowe}
Pierwszym rozważanym modelem jest klasyczny losowy graf Erd\H{o}s-Rényi (ER) zaproponowany przez Erd\H{o}s’a i Rényi’ego w 1959 roku \cite{ErdosRenyi1960}. W modelu tym rozpatruje się zbiór $n$ wierzchołków, a każda z $\binom{n}{2}$ potencjalnych krawędzi pojawia się niezależnie z prawdopodobieństwem $p$. Parametrami modelu są więc $n$ (liczba wierzchołków) oraz $p$ (prawdopodobieństwo powstania pojedynczej krawędzi). W implementacji \texttt{GraphGeneratorFactory} zaadaptowano właśnie ten wariant $G(n,p)$.


Model ER stanowi istotny punkt odniesienia jako najprostszy model sieci pozbawiony struktury społecznościowej. Motywacją uwzględnienia go w testach jest możliwość porównania działania algorytmów na zupełnie przypadkowych sieciach z ich działaniem na bardziej uporządkowanych grafach (skalowanych, małego świata oraz rzeczywistych). Choć prawdziwe sieci społecznościowe odbiegają od założeń pełnej losowości (np. mają zwykle wyższy poziom klasteryzacji węzłów i nierównomierny rozkład stopni), to jednak model $G(n, p)$ posiada podstawę porównawczą.

Z punktu widzenia właściwości, grafy ER cechują się stosunkowo niskim średnim współczynnikiem klasteryzacji (oczekiwana wartość współczynnika klasteryzacji jest równa $p$ dla dużego $n$) oraz (dla dostatecznie dużego $p$) powstawaniem jednej gigantycznej składowej spójnej. Istnieje znana granica perkolacji: gdy $p$ przekroczy około $\frac{\ln n}{n}$, graf $G(n, p)$ jest z dużym prawdopodobieństwem spójny - poniżej tego progu sieć rozpada się na wiele komponentów \cite{ErdosRenyi1960}. Gęstość grafu (rozumiana jako odsetek istniejących krawędzi w stosunku do wszystkich możliwych) wynosi w tym modelu w przybliżeniu $p$ (np. dla $p=0.1$ graf będzie miał ok. 10\% maksymalnej liczby krawędzi). Rozkład stopni w modelu ER ma charakter dwumianowy, a w granicy dużego $n$ zbiega do rozkładu Poissona. Oznacza to, że w grafach tych nie występują węzły o niezwykle wysokich stopniach (tzw. huby), które są charakterystyczne dla wielu rzeczywistych sieci społecznych. W konsekwencji model ER nie oddaje wielu kluczowych właściwości takich sieci - stanowi jednak użyteczny model kontrolny, pozbawiony zjawisk typu „mały świat” czy „skalowość”, dzięki czemu można wyraźnie uwypuklić wpływ tych cech w innych modelach.

% \textbf{NIE WIEM CZY TO JEST POTRZEBNE:} W celu zilustrowania struktury sieci opisywanych grafów wykorzystano własnoręcznie przygotowane wizualizacje grafów. Do wygenerowania tych wizualizacji zaimplementowano pomocniczą klasę GraphVisualizer w języku Python, korzystającą z biblioteki NetworkX oraz Matplotlib do renderowania grafu. Narzędzie to umożliwia prezentację grafu ze stałymi pozycjami węzłów oraz wyróżnienie określonych grup wierzchołków za pomocą kolorów.

\subsection{Zakresy parametrów generatorów}
\label{sec:gen-ranges}
W eksperymentach korzystamy z ustalonych siatek parametrów, co ułatwia porównywalność wyników i replikację. Tabela \ref{tab:gen-ranges} zestawia typowe zakresy.

\begin{table}[h]
\centering
\begin{tabular}{@{}lll@{}}
\toprule
Model & Parametry & Zakres w eksperymentach \\
\midrule
Erdős-Rényi $G(n,p)$ & $n, p$ & $n\in\{10,30,\dots,90\}$; $p\in\{0.05,0.10\}$ \\
Barabási-Albert & $n, m$ & $n\in\{10,30,\dots,990\}$; $m\in\{2,3\}$ \\
Watts-Strogatz & $n, k, p$ & $n\in\{10,30,\dots,230\}$; $k\in\{4,6,8\}$ (parzyste); $p\in\{0.05,0.10\}$ \\
\bottomrule
\end{tabular}
\caption{Przykładowe zakresy parametrów generatorów grafów syntetycznych.}
\label{tab:gen-ranges}
\end{table}

\subsection{Model Barabási-Albert - sieci bezskalowe}
Drugim wykorzystanym generatorem jest model Barabási-Albert (BA), wprowadzony przez Barabási’ego i Alberta w 1999 roku \cite{barabasi1999emergence}. Model BA pozwala generować grafy o strukturze bezskalowej, których rozkład stopni wierzchołków przyjmuje postać potęgową. Tego typu sieci charakteryzują się istnieniem niewielkiej liczby wierzchołków o bardzo wysokim stopniu (tzw. hubów) oraz wielu wierzchołków o małym stopniu - jest to cecha obserwowana w wielu rzeczywistych sieciach, w tym społecznościowych (np. niektórzy użytkownicy mogą mieć tysiące znajomych/obserwujących, podczas gdy większość ma ich kilkudziesięciu lub mniej).

Parametrem wejściowym modelu Barabási-Albert w implementacji \texttt{GraphGeneratorFactory} jest przede wszystkim $n$ - docelowa liczba węzłów w grafie - oraz $m$ - liczba krawędzi, jakie dodaje każdy nowy węzeł. Procedura generowania rozpoczyna się od małego grafu startowego (np. klika złożona z $m$ wierzchołków, aby zapewnić początkową spójność). Następnie dodaje się kolejno nowe wierzchołki; każdy nowy węzeł łączy się z $m$ już istniejącymi wierzchołkami, przy czym prawdopodobieństwo połączenia z danym istniejącym węzłem jest proporcjonalne do jego bieżącego stopnia (tzw. reguła preferencyjnego łączenia, ang. preferential attachment). W efekcie „bogaci stają się bogatsi” - wierzchołki, które zyskały wiele połączeń na wcześniejszych etapach, mają większą szansę zdobyć kolejne połączenia, co prowadzi do wykładniczego (potęgowego) rozkładu stopni.

Motywacją użycia modelu BA było odzwierciedlenie w danych testowych właściwości często spotykanej w sieciach społecznościowych i sieciach informacji - silnego zróżnicopwania w stopniach węzłów. Dzięki grafom BA można przetestować algorytmy pod kątem radzenia sobie z obecnością hubów oraz z rozkładem stopni o ciężkim ogonie (ang. heavy-tailed distribution). Pojęcie ciężkiego ogona oznacza, że prawdopodobieństwo wystąpienia wierzchołków o bardzo dużym stopniu maleje stosunkowo wolno - w efekcie w sieci, obok wielu węzłów o niskim stopniu, pojawia się również pewna liczba hubów o ekstremalnie wysokim stopniu. Zjawisko to odróżnia sieci bezskalowe od np. grafów ER, w których prawdopodobieństwo pojawienia się węzłów o bardzo dużej liczbie sąsiadów jest znikome.

Grafy generowane modelem BA mają z reguły jedną spójną komponentę (przy założeniu, że graf startowy jest spójny i $m \ge 1$, każdy nowy wierzchołek dołącza do istniejącej struktury, więc sieć pozostaje spójna). Średni stopień w takim grafie wynosi około $2m$. Stąd gęstość grafu BA maleje wraz ze wzrostem $n$ - dla dużych grafów jest ona rzędu $\frac{2m}{n}$, co oznacza, że grafy te są rzadkie. W przeciwieństwie do modelu ER, współczynnik skupienia grafów BA nie jest determinowany przez pojedynczy parametr w oczywisty sposób - klasyczny model BA generuje sieci o stosunkowo niskim średnim clusteringu (niższym niż obserwowany w rzeczywistych sieciach społecznych), ponieważ nowe połączenia tworzone są głównie z hubami, co sprzyja tworzeniu gwiazd zamiast trójkątów. Istnieją modyfikacje modelu BA dodające mechanizmy triadycznego dosłączania, które zwiększają clustering - jednak w czystej postaci model BA zazwyczaj skutkuje średnim współczynnikiem skupienia malejącym wraz z rozmiarem grafu. Niemniej jednak, nawet przy relatywnie niskim clusteringu, grafy BA zachowują własność małych średnich odległości. Powyższe cechy sprawiają, że grafy BA stanowią przydatny model testowy - oddają one istnienie hubów i krótkie odległości jak w wielu sieciach społecznych, choć nie odwzorowują silnego grupowania lokalnego.

\subsection{Model Watts-Strogatz (graf małego świata)}
Trzecim fundamentalnym modelem zaimplementowanym w \texttt{GraphGeneratorFactory} jest model Watts-Strogatz (WS), opisany przez Wattsa i Strogatza w 1998 roku \cite{Watts1998}. Umożliwia on generowanie grafów małego świata (small-world networks), które łączą w sobie dwie istotne cechy: wysoki współczynnik skupienia (podobny do obserwowanego w sieciach regularnych, np. sieci sąsiedztw) oraz niską średnią odległość (podobnie jak w grafach losowych). Model ten odzwierciedla fakt, że w sieciach społecznych często występują silnie zżyte grupy znajomych (wysokie clustering w skali lokalnej), a jednocześnie dowolne dwie osoby są połączone relatywnie krótką ścieżką znajomości.

Generacja grafu WS wymaga trzech parametrów: $n$ - liczby wierzchołków, $k$ - stopnia każdego wierzchołka w początkowej regularnej strukturze oraz $p$ - prawdopodobieństwa przepięcia (ang. rewiring) krawędzi. Procedura rozpoczyna się od utworzenia grafu regularnego: każdy wierzchołek jest połączony z $k$ najbliższymi sąsiadami w pierścieniu (tj. tworzymy pierścień z $n$ węzłów, a następnie każdy węzeł łączymy z $\frac{k}{2}$ następnymi i $\frac{k}{2}$ poprzednimi na pierścieniu, zakładając dla uproszczenia, że $k$ jest parzyste). Tak powstała sieć ma wysokie lokalne skupienie - węzły sąsiadujące na pierścieniu tworzą krótkie kliki. Jednocześnie początkowa średnia odległość jest stosunkowo duża (graf ma strukturę pierścienia, więc dystans między węzłami oddalonymi na pierścieniu jest znaczny).

Następnie, w modelu WS wprowadza się losowe przepięcia: dla każdej krawędzi łączącej węzeł z jednym z $\frac{k}{2}$ najbliższych sąsiadów „z prawej strony” pierścienia - dokonuje się, z prawdopodobieństwem $p$, przepięcia jednego końca tej krawędzi do losowo wybranego innego wierzchołka. Przepięcie polega na usunięciu oryginalnej krawędzi i dodaniu nowej krawędzi łączącej dany węzeł z innym losowym węzłem (według oryginalnej pracy Wattsa-Strogatza unika się powielania istniejących krawędzi i pętli, wybierając tylko takie nowe połączenie, które nie istniało wcześniej). W wyniku tych losowych przepięć przy zachowaniu większości lokalnych połączeń pierścienia otrzymujemy graf, który dla małych $p$ wciąż ma wysoki współczynnika klasteryzacji, ale jednocześnie kilka losowych „skoków” znacząco skraca średnie odległości w sieci. Dla umiarkowanych wartości $p$ (np. $p \approx 0.01$ czy $0.1$) sieć uzyskuje bardzo małą średnią odległość - zbliżoną do grafów losowych - podczas gdy clustering pozostaje o rząd wielkości wyższy niż w grafie Erd\H{o}s-Rényi o porównywalnej gęstości. To właśnie fenomen „małego świata”: jednoczesne występowanie silnego grupowania lokalnego i krótkich ścieżek globalnych \cite{Watts1998}.

W kontekście modelowania sieci społecznych, generator dla modelu WS dodano w celu odzwierciedlenia właściwości, których brakuje modelowi BA - mianowicie wysokiego lokalnego współczynnika klasteryzacji. Sieci społeczne cechują się tym, że znajomi często znają się nawzajem, tworząc kliki znajomych. Model WS pozwala symulować taką sytuację i sprawdzić, jak algorytmy radzą sobie np. z wykrywaniem społeczności czy zjawisk rozprzestrzeniania się informacji w warunkach silnego grupowania. Parametr $k$ decyduje o początkowej gęstości połączeń lokalnych - większe $k$ to więcej krawędzi lokalnych (każdy węzeł ma początkowo $k$ sąsiadów), a zatem wyjściowo wyższy współczynnik klasteryzacji i gęstość. Parametr $p$ natomiast kontroluje losowość grafu: dla $p=0$ otrzymujemy graf regularny, zaś dla $p=1$ graf staje się w dużej mierze losowy. W praktycznych zastosowaniach interesujący jest zakres $p$ między 0 a 1, gdzie pojawia się mały świat.

Grafy WS generowane do testów miały parametry dobrane w taki sposób, aby możliwie dobrze odwzorowywać cechy typowe dla niedużych sieci społecznych. Uzyskiwane w ten sposób sieci charakteryzowały się relatywnie niską gęstością, ale jednocześnie wysokim współczynnikiem klasteryzacji, znacznie przewyższającym wartości obserwowane w losowych grafach ER o podobnej gęstości. Dzięki temu w grafach WS obecne są realistyczne zgrupowania lokalne, odpowiadające typowym kręgom znajomych w sieciach społecznych. Co istotne, sieci te z reguły pozostają spójne - niemal wszystkie wierzchołki należą do jednej dużej komponenty, a ewentualne izolowane węzły pojawiają się jedynie sporadycznie przy skrajnych ustawieniach parametrów. Taka struktura sprawia, że model WS stanowi dobre środowisko testowe.


\IfFileExists{barabasi_n100_m2_example.png}{%
  \begin{figure}[ht]
  \centering
  \includegraphics[width=0.4\textwidth]{barabasi_n100_m2_example.png}
  \caption{Przykład grafu Barabási-Albert ($n=100$, $m=2$) wygenerowanego syntetycznie. Widoczne jest istnienie kilku węzłów o wysokim stopniu (hubów) oraz licznych węzłów peryferyjnych o małej liczbie połączeń.}
  \label{fig:ba100m2}
  \end{figure}
}{% brak pliku — pomiń ilustrację
}

% \section{Grafy rzeczywiste}

% Drugim zestawem danych testowych są rzeczywiste grafy pochodzące z sieci społecznościowej Facebook, a dokładniej zbiór Facebook Ego Network udostępniony w ramach Stanford Network Analysis Project (SNAP) \cite{McAuley2012}. Dane te zostały zebrane przez J. McAuley i J. Leskoveca z Uniwersytetu Stanforda w ramach badań nad odkrywaniem kręgów społecznych \cite{McAuley2012}. Zbiór zawiera dziesięć ego-sieci (sieci ego-centryczne) użytkowników Facebooka, pozyskane za zgodą uczestników poprzez specjalną aplikację facebookową. Ego-sieć to sieć społeczna z perspektywy pojedynczego użytkownika (zwanego ego) - węzłami są ego oraz wszystkie jego bezpośrednie znajome osoby, zaś krawędzie reprezentują relacje znajomości między tymi osobami (bezpośrednie połączenia między znajomymi ego). W kontekście udostępnionych danych, każda z dziesięciu sieci odpowiada innej osobie (ego) i zawiera wyłącznie jej znajomych oraz powiązania między nimi (dany ego nie jest explicite ujęty jako wierzchołek w grafie, ale możemy go traktować jako ukrytą centralną jednostkę łączącą wszystkich znajomych).

% Do wczytania i wykorzystania danych rzeczywistych w testach zaimplementowano klasę \texttt{RealWorldDataLoader}, która przetwarza pliki udostępnione przez SNAP. Każda ego-sieć zapisana jest w osobnych plikach tekstowych, których nazwa odpowiada identyfikatorowi ego (np. \texttt{0.edges}, \texttt{0.circles}, \texttt{0.feat} itd. dla ego o ID=0). Struktura danych jest następująca:

% Plik \texttt{*.edges}: lista krawędzi w sieci znajomych danego ego. Każdy wiersz zawiera dwie liczby - identyfikatory dwóch użytkowników (znajomych ego), między którymi istnieje relacja znajomości. Krawędzie dla Facebooka są nieskierowane. Ważną cechą jest to, że plik \texttt{.edges} nie zawiera połączeń od ego do jego znajomych - wierzchołek ego w ogóle nie występuje w tym pliku. Innymi słowy, graf opisany w \texttt{X.edges} dotyczy jedynie znajomych użytkownika X i relacji pomiędzy nimi. Należy zatem pamiętać, że rzeczywista sieć ego uwzględniałaby jeszcze krawędzie łączące ego z każdym z węzłów pojawiających się w \texttt{X.edges}, ale tych połączeń tu nie zapisano (są one niejako domyślne - możemy założyć, że ego ma krawędź do każdego ze swoich znajomych). Pominięcie węzła ego jest typowe, gdyż pozwala skupić się na relacjach wewnątrz kręgów znajomych. Konsekwencją tego jest często podział grafu znajomych na kilka komponentów - jeśli ego miał różne grupy znajomych wzajemnie się nieznających, to w pliku \texttt{.edges} każda taka grupa stanowi osobną składową spójną (ego, jako jedyny łącznik, został usunięty z grafu). Przykładowo, w ego-sieci \texttt{0.edges} znajomi tworzą 5 komponentów spójnych - co oznacza, że badany użytkownik 0 miał około pięć odrębnych grup znajomych niepowiązanych ze sobą, które dopiero poprzez niego stawały się pośrednio połączone. Z perspektywy testów algorytmów, analiza takiego grafu znajomych pozwala sprawdzić, czy metody wykryją istnienie tych podgrup.

% % OD TĄD TERAZ SPRAWDZAJ DALEJ !!!

% Plik \texttt{*.circles}: zbiór kręgów znajomych zdefiniowanych przez użytkownika. Każdy wiersz pliku reprezentuje jeden taki krąg. Wiersz rozpoczyna się od nazwy kręgu - jednak w udostępnionych danych nazwy te również zostały zanonimizowane lub pominięte, więc praktycznie każdy wiersz zaczyna się od identyfikatora kręgu albo pustej nazwy, po czym następuje lista ID użytkowników należących do tego kręgu. Kręgi mogą się pokrywać częściowo i nie muszą stanowić rozłącznych społeczności w sensie grafu - są to raczej informacja dodatkowa od ego, jak kategoryzuje swoich znajomych. Dane te są cenne jako metadane do walidacji - np. w oryginalnej pracy \cite{McAuley2012} posłużyły do oceny algorytmów automatycznie wykrywających społeczności. W naszej pracy informacje z \texttt{*.circles} nie były głównym przedmiotem analizy, ale zostały odnotowane dla ewentualnego wykorzystania przy interpretacji wyników.

% Plik \texttt{*.feat}: macierz cech przypisanych do znajomych ego. Każdy wiersz odpowiada jednemu znajomemu i zawiera zestaw atrybutów tej osoby. Cechy te mogą obejmować informacje z profilu Facebooka, np. miejsce pracy, szkoła, zainteresowania, itp. W udostępnionym zbiorze zostały one zanonimizowane - nie znamy dokładnego znaczenia poszczególnych cech, jedynie ich binarne wartości (1 - użytkownik ma daną cechę, 0 - nie ma). Istnieje także plik \texttt{.featnames} zawierający oryginalne nazwy cech, ale w przypadku Facebooka nazwy te również zostały zanonimizowane (np. zamiast "szkoła: Uniwersytet Stanford" mamy "anonimowa cecha 57"). W niniejszej pracy dane atrybutów nie były bezpośrednio wykorzystywane w algorytmach (skupiono się na strukturze grafów), jednak obecność tych plików została uwzględniona w klasie \texttt{RealWorldDataLoader} dla ewentualnej rozbudowy eksperymentów o analizę wielowarstwową (np. użycie cech węzłów do ulepszenia detekcji społeczności lub analizy homofilii).

% Plik \texttt{*.egofeat}: wektor cech centralnego użytkownika (ego). Ma ten sam format co pojedynczy wiersz \texttt{*.feat}, tylko odnosi się do ego. Pozwala to np. porównać cechy ego z cechami jego znajomych. W kontekście naszej analizy plik ten również nie był wykorzystywany, poza weryfikacją spójności danych.

% Klasa \texttt{RealWorldDataLoader} wczytuje powyższe pliki dla zadanych identyfikatorów sieci, tworząc wewnętrzną reprezentację grafu (lista sąsiedztwa lub macierz sąsiedztwa) oraz zbierając opcjonalnie informacje o atrybutach i kręgach. Na potrzeby testów skupiliśmy się głównie na strukturze grafu znajomych (pliki \texttt{*.edges}), jako że badane algorytmy operowały na grafach.

% Spośród dziesięciu dostępnych ego-sieci Facebooka wybrano do testów te, które spełniały założone kryterium rozmiaru: od 20 do 200 wierzchołków (nie licząc ego). Zbyt małe sieci (<20 węzłów) byłyby mało reprezentatywne i mogłyby nie zawierać wyraźnych struktur, z kolei zbyt duże (>200) były trudniejsze w ręcznej analizie i mogły znacząco wydłużać czas wykonywania pewnych algorytmów w ramach pracy. Identyfikatory wybranych sieci to między innymi: 3980, 414, 686 oraz 698 - każda z nich zawiera od kilkudziesięciu do około $\sim$150-200 węzłów (dokładne rozmiary: np. sieć 3980 to jedna z najmniejszych, zaś sieć 414 jest bliska górnej granicy tego przedziału). Sieci te pochodzą z oryginalnego zbioru SNAP i odpowiadają anonimowym użytkownikom Facebooka oznaczonym tymi ID. Poniżej przedstawiono podstawowe statystyki i właściwości tych grafów rzeczywistych:

% Rozmiar sieci: wybrane ego-sieci mają różną wielkość, ale mieszczą się w przedziale 20-200 wierzchołków oraz odpowiednio od kilkudziesięciu do kilku tysięcy krawędzi. Przykładowo, sieć o ID 3980 zawiera kilkadziesiąt użytkowników (dokładna liczba wierzchołków $\approx 30$-40) i relatywnie niewielką liczbę połączeń między nimi (być może kilkadziesiąt krawędzi, w zależności od tego ilu spośród znajomych danego ego wzajemnie się znało). Z kolei nieco większa sieć o ID 414 ma już blisko dwieście węzłów i kilkaset krawędzi. Ogólnie, im większa liczba znajomych danego ego, tym potencjalnie więcej połączeń między nimi - aczkolwiek zależy to od charakteru społecznego ego (niektórzy użytkownicy pełnią rolę „łączników” grup, inni mają kilka odrębnych grup znajomych). Warto zauważyć, że sumarycznie po złączeniu wszystkich 10 ego-sieci zbiór obejmuje 4039 unikalnych wierzchołków i 88234 krawędzie \cite{McAuley2012}, co obrazuje jak duże mogą być sieci pojedynczych osób (średnio kilkuset znajomych każdy i sporo połączeń między nimi). My jednak analizujemy każdą sieć oddzielnie, gdyż są one niezależne (choć w oryginalnym zbiorze stwierdzono, że niektórzy uczestnicy mieli wspólnych znajomych, przez co ego-sieci nie są całkowicie rozłączne - zdarza się, że jeden węzeł należy do dwóch ego-sieci, jeśli dwaj uczestnicy badania byli znajomymi).

% Liczba komponentów spójnych: jak wspomniano wcześniej, z powodu braku węzła ego w grafie znajomych, większość ego-sieci dzieli się na więcej niż jedną składową spójną. W praktyce jednak zazwyczaj istnieje jedna dominująca komponenta zawierająca największą grupę wzajemnie powiązanych znajomych oraz kilka mniejszych komponentów (np. dwuosobowych lub kilkuosobowych grup) odpowiadających odizolowanym kręgom znajomych. Dla przykładu, sieć 107.edges (niewykorzystana u nas ze względu na rozmiar, ale dla ilustracji) była całkowicie spójna - wszyscy znajomi użytkownika 107 tworzyli jeden klaster połączony również ze sobą \cite{McAuley2012}. Natomiast sieć 0.edges (333 węzły) miała 5 komponentów - co już sygnalizowano. Wśród naszych analizowanych sieci: sieć 686.edges jest spójna (1 komponent), sieć 414.edges dzieli się na 2 komponenty, sieć 698.edges na 3, a sieć 3980.edges na 4 komponenty (dane na podstawie analizy krawędzi w plikach). Zwykle największy komponent obejmuje znaczną większość wierzchołków (np. w sieci 414.edges ponad 80\% znajomych mogło stanowić jeden klaster, a reszta tworzyła małą odrębną grupkę). Taka struktura wskazuje na obecność jednego głównego kręgu znajomych, uzupełnionego kilkoma pobocznymi znajomościami niepowiązanymi z resztą.

% Średni współczynnik skupienia: ego-sieci Facebooka cechują się na ogół wysokim clusteringiem, co jest zgodne z intuicją - znajomi konkretnej osoby często znają się nawzajem. W literaturze podaje się, że globalny współczynnik skupienia dla całego grafu wszystkich użytkowników Facebooka jest stosunkowo niski (np. ok. 0.1 w 2009 roku \cite{Ugander2011}), ale to dlatego, że obejmuje on również połączenia między ludźmi, którzy nie mają wspólnych znajomych. Natomiast w obrębie ego-sieci (gdzie wszyscy rozpatrywani ludzie są znajomymi jednego ego) clustering jest znacznie wyższy. Dla połączonej sieci 10 ego (4039 węzłów) średni clustering wynosił aż 0.6055 \cite{McAuley2012}, co oznacza, że dwaj losowo wybrani znajomi ego mają ponad 60\% szans, że są również wzajemnie znajomymi. W naszych mniejszych sieciach wartości te mogą się różnić, ale zwykle mieszczą się w przedziale 0.5-0.6 dla największego komponentu (przy czym mniejsze komponenty, np. dwuosobowe, mają clustering 0 lub nieokreślony). Wysoki średni współczynnik skupienia potwierdza silne lokalne powiązania - wiele trójkątów w grafie (znajomi znają się parami). Dla przykładu, jeśli ego posiada grupę przyjaciół ze szkoły, prawdopodobne jest, że większość z nich zna się nawzajem, tworząc kliki o dużym clusteringu.

% Gęstość sieci: gęstość, rozumiana jako stosunek liczby istniejących krawędzi do maksymalnej liczby krawędzi dla danej liczby węzłów, w ego-sieciach jest stosunkowo niska w kategoriach absolutnych (bo sieci społeczne są z natury rzadkie), ale wyższa niż w losowo generowanych grafach tej skali. Dla zobrazowania, jedna z większych ego-sieci (ID 0, 333 węzłów) miała 5038 krawędzi, co daje gęstość ok. 0.091 (9.1\%) - czyli spośród wszystkich możliwych par znajomych, około 9\% par było faktycznie znajomymi. W przypadku sieci 107 (1034 węzły, 26749 krawędzi) gęstość wyniosła ok. 0.05 (5\%) \cite{McAuley2012}. Nasze mniejsze sieci, takie jak 3980 czy 698, mogą mieć nieco wyższe gęstości ze względu na efekt mniejszych grup (jeśli ego ma 30 znajomych którzy wszyscy się znają, to gęstość jest bardzo wysoka, bliska 100\%; jednak zazwyczaj nie wszyscy znają wszystkich, więc realnie gęstości wynoszą kilkanaście-kilkadziesiąt procent dla naprawdę małych sieci i kilka procent dla większych). Ogólnie, gęstość maleje wraz ze wzrostem liczby wierzchołków - większe kręgi znajomych rzadziej są kompletnie połączone. W porównaniu do grafów losowych o podobnej wielkości i liczbie krawędzi, ego-sieci mają wyższy clustering (krawędzie nie są rozłożone przypadkowo, lecz skupione wewnątrz grup), natomiast same wartości gęstości nie odbiegają rzędu wielkościowo - nadal są to grafy rzadkie (rzędu pojedynczych procent). Ta rzadka natura sieci społecznych jest istotna dla testowanych algorytmów, gdyż wiele z nich ma złożoności silnie zależne od liczby krawędzi.

% Podsumowując, rzeczywiste dane z Facebook Ego Network dostarczyły cennych przykładów małych sieci społecznych z realnymi właściwościami. Dzięki nim możliwe było zweryfikowanie, czy implementowane algorytmy radzą sobie z naturalnymi strukturami takimi jak kliki znajomych, huby (np. ego jako ukryty hub łączący komponenty), czy rozkłady stopni bliskie rzeczywistości. Analiza tych sieci pozwoliła również na porównanie wyników z danymi syntetycznymi - np. sprawdzenie, czy modele generatywne (ER, BA, WS) oddają cechy obserwowane w prawdziwych sieciach. W dalszych rozdziałach, przy omawianiu wyników eksperymentów, będziemy odwoływać się do opisanych tu zbiorów danych testowych.

% \begin{figure}[ht]
% \centering
% % \includegraphics[width=0.75\textwidth]{ego_networks_size_histogram.png}
% \caption{Histogram rozmiarów ego-sieci Facebooka w zbiorze SNAP. Oś $x$ przedstawia liczbę wierzchołków (znajomych w sieci ego), oś $y$ - liczbę sieci (ego) posiadających daną wielkość. Widzimy zróżnicowanie rozmiarów: od kilkudziesięciu do ponad tysiąca znajomych, przy czym do testów wybrano sieci z zakresu 20-200 wierzchołków (zacieniowany przedział na wykresie).}
% \label{fig:ego-size-histogram}
% \end{figure}

% \begin{figure}[ht]
% \centering
% % \includegraphics[width=0.7\textwidth]{ego_network_visualization.png}
% \caption{Przykładowa wizualizacja ego-sieci (dla wybranego użytkownika). Węzeł centralny (ego) został pominięty na grafie - widoczne są jedynie wzajemne połączenia między jego znajomymi. Kolorem wyróżniono komponenty spójne, czyli grupy znajomych, którzy znają się nawzajem. Taka sieć odpowiada strukturze pliku \texttt{X.edges}: każda z oddzielnych grup sugeruje odrębny krąg towarzyski ego.}
% \label{fig:ego-network-example}
% \end{figure}

% (usunięto wzmianki o Google+; w pracy wykorzystano ego-sieci Facebooka)

\section{Grafy rzeczywiste}
Drugim zestawem danych testowych są rzeczywiste grafy pochodzące z sieci społecznościowej Facebook, a dokładniej zbiór \texttt{Facebook Ego Network} udostępniony w ramach Stanford Network Analysis Project (SNAP). Dane te zostały zebrane w 2012 roku przez J. McAuley i J. Leskovca z Uniwersytetu Stanforda w ramach badań nad automatycznym wykrywaniem kręgów społecznych. Zbiór zawiera dziesięć tzw. ego-sieci - sieci ego-centrycznych poszczególnych użytkowników Facebooka, pozyskane za zgodą uczestników poprzez specjalną aplikację facebookową. Ego-sieć to sieć społeczna z perspektywy pojedynczego użytkownika (zwanego \textit{ego}) - węzłami są \textit{ego} oraz wszystkie jego bezpośrednie znajome osoby, zaś krawędzie reprezentują relacje znajomości pomiędzy tymi znajomymi. W udostępnionych danych każda z dziesięciu sieci odpowiada innemu użytkownikowi (\textit{ego}) i zawiera wyłącznie jego znajomych oraz powiązania między nimi. Węzeł \textit{ego} nie jest jawnie ujęty jako wierzchołek w grafie (można go traktować jako ukrytą centralną jednostkę łączącą wszystkich znajomych). Innymi słowy, graf zapisany w pliku \verb|X.edges| dotyczy tylko znajomych użytkownika $X$ i relacji między nimi - sam $X$ nie pojawia się w pliku jako węzeł.

Do wczytania i wykorzystania tych danych rzeczywistych w testach zaimplementowano klasę \verb|RealWorldDataLoader|, która przetwarza pliki udostępnione przez SNAP. Każda ego-sieć zapisana jest w osobnych plikach tekstowych, których nazwa odpowiada identyfikatorowi \textit{ego} (np. \verb|0.edges|, \verb|0.circles|, \verb|0.feat|, \verb|0.egofeat| dla \textit{ego} o ID=0). Struktura danych jest następująca:

\textbf{Plik .edges} - lista krawędzi w grafie znajomych danego \textit{ego}. Każdy wiersz zawiera dwie liczby - identyfikatory dwóch różnych znajomych \textit{ego}, między którymi istnieje relacja koleżeńska. Krawędzie te są nieskierowane. Ważną cechą jest to, że plik \verb|.edges| nie zawiera połączeń od \textit{ego} do jego znajomych - wierzchołek \textit{ego} w ogóle nie występuje w tym pliku. Oznacza to, że rzeczywista sieć \textit{ego} (gdyby uwzględnić w niej węzeł \textit{ego}) miałaby dodatkowo krawędź łączącą \textit{ego} z każdym z pojawiających się znajomych, jednak tych połączeń tutaj nie zapisano (są one domyślne - zakładamy, że \textit{ego} jest połączone ze wszystkimi swoimi znajomymi). Pominięcie węzła \textit{ego} jest zabiegiem celowym, pozwalającym skupić się na relacjach wewnątrz kręgów znajomych. Konsekwencją tego jest często podział grafu znajomych na kilka komponentów - jeśli \textit{ego} ma różne grupy znajomych wzajemnie się nieznających, to w pliku \verb|.edges| każda taka grupa stanowi osobną składową spójną (\textit{ego}, jako jedyny łącznik, został usunięty z grafu). Przykładowo, w ego-sieci \verb|0.edges| znajomi tworzą 5 odrębnych komponentów spójnych. Oznacza to, że użytkownik o ID 0 miał około pięć niezależnych grup znajomych niepowiązanych ze sobą - dopiero poprzez jego osobę (\textit{ego}) stawały się one pośrednio połączone. Z perspektywy testów algorytmów, analiza takiego grafu pozwala sprawdzić, czy badane metody potrafią wykryć istnienie tych podgrup w sieci.

\textbf{Plik .circles} - zestaw kręgów znajomych zdefiniowanych przez użytkownika (\textit{ego}). Każdy wiersz pliku reprezentuje jeden krąg towarzyski. Wiersz rozpoczyna się od nazwy kręgu - jednak w udostępnionych danych nazwy te zostały zanonimizowane lub pominięte, więc w praktyce każdy wiersz zaczyna się od identyfikatora kręgu albo pustej nazwy, po czym następuje lista ID użytkowników należących do tego kręgu. Kręgi mogą częściowo się pokrywać i nie muszą stanowić rozłącznych społeczności w sensie grafu - są to raczej dodatkowe metadane od \textit{ego}, opisujące jak kategoryzuje on swoich znajomych. Informacje te mogą być cenne pomocniczo, np. w oryginalnej pracy McAuley'ego i Leskovca posłużyły do oceny algorytmów automatycznie wykrywających społeczności. W niniejszej pracy dane z plików \verb|.circles| nie były bezpośrednim przedmiotem analizy, ale zostały wczytane i zachowane w strukturze danych na potrzeby ewentualnej interpretacji wyników (np. sprawdzenia, czy wykryte przez algorytmy grupy pokrywają się z kręgami zdefiniowanymi przez użytkownika).

\textbf{Plik .feat} - macierz cech atrybutów przypisanych do znajomych \textit{ego}. Każdy wiersz odpowiada jednemu znajomemu i zawiera wektor wartości cech tej osoby. Cechy te mogą obejmować informacje z profilu Facebooka (np. miejsce pracy, szkoła, zainteresowania itp.). W udostępnionym zbiorze wartości atrybutów zostały zanonimizowane - nie znamy dokładnego znaczenia poszczególnych cech, jedynie ich binarne wartości (1 - użytkownik posiada daną cechę, 0 - nie posiada). Istnieje także plik \verb|.featnames| zawierający oryginalne nazwy cech, ale w przypadku Facebooka nazwy te również zostały zanonimizowane (np. zamiast ``szkoła: Uniwersytet Stanford'' pojawia się ``anonimowa cecha 57''). W niniejszej pracy dane atrybutów nie były wykorzystywane przez algorytmy (skupiono się na strukturze grafów), jednak klasa \verb|RealWorldDataLoader| została przygotowana tak, aby wczytać także te informacje na potrzeby ewentualnej rozbudowy eksperymentów o analizę wielowarstwową (np. użycie cech węzłów do ulepszenia detekcji społeczności lub zbadania zjawiska homofilii).
\textbf{Plik .egofeat} - wektor cech centralnego użytkownika (\textit{ego}), w tym samym formacie co pojedynczy wiersz pliku \verb|.feat|, odnoszący się jednak do \textit{ego}. Pozwala to porównać cechy \textit{ego} z cechami jego znajomych. W kontekście naszych badań plik ten również nie był bezpośrednio wykorzystywany, poza podstawową walidacją danych (sprawdzenie spójności liczby cech itp.).

Klasa \verb|RealWorldDataLoader| wczytuje powyższe pliki dla zadanych identyfikatorów sieci, tworząc na ich podstawie wewnętrzną reprezentację grafu (lista sąsiedztwa przy użyciu struktury \verb|Graph| z biblioteki \texttt{NetworkX}) oraz opcjonalnie zbierając informacje o atrybutach i kręgach znajomych. W implementacji tej klasy wykorzystano funkcje biblioteki \texttt{NetworkX} do dodawania wierzchołków i krawędzi na podstawie list znajomych (plik \verb|.edges|), jak również do obliczania podstawowych parametrów sieci (np. współczynnik klasteryzacji, gęstość). Na potrzeby testów skupiliśmy się głównie na strukturze grafu znajomych (czyli krawędziach z plików \verb|.edges|), gdyż to na grafach opierają się badane algorytmy. Spośród dziesięciu dostępnych ego-sieci Facebooka wybrano do eksperymentów te, które spełniały założone kryterium rozmiaru: od 20 do 200 wierzchołków (nie licząc węzła \textit{ego}). Zbyt małe sieci (poniżej 20 węzłów) byłyby mało reprezentatywne i mogły nie zawierać wyraźnych struktur, z kolei zbyt duże (powyżej 200 węzłów) były trudniejsze w ręcznej analizie oraz mogły znacząco wydłużyć czas działania niektórych algorytmów. Identyfikatory wybranych sieci to między innymi: 3980, 414, 686 oraz 698 - każda z nich zawiera od kilkudziesięciu do ok. 150-200 węzłów. Sieci te pochodzą z oryginalnego zbioru SNAP i odpowiadają anonimowym użytkownikom Facebooka oznaczonym tymi ID.

Poniżej przedstawiono podstawowe statystyki i właściwości tych grafów rzeczywistych:

\subsubsection{Rozmiar sieci (liczba węzłów i krawędzi)}
Wybrane ego-sieci mają różną wielkość, mieszcząc się jednak w przedziale 20-200 wierzchołków, oraz od kilkudziesięciu do kilku tysięcy krawędzi. Przykładowo, sieć o ID 3980 zawiera kilkudziesięciu użytkowników (dokładna liczba wierzchołków to ok. 30-40) i relatywnie niewielką liczbę połączeń między nimi (rzędu kilkudziesięciu krawędzi, w zależności od tego ilu spośród znajomych danego \textit{ego} wzajemnie się znało). Z kolei większa sieć o ID 414 ma już blisko 200 węzłów i kilkaset krawędzi. Ogólnie im większa liczba znajomych danego \textit{ego}, tym potencjalnie więcej połączeń między nimi - aczkolwiek zależy to od charakteru społecznego samego \textit{ego} (niektórzy użytkownicy pełnią rolę ``łączników'' różnych grup, inni mają kilka odrębnych grup znajomych). Warto zauważyć, że po połączeniu wszystkich 10 ego-sieci zbiór obejmuje łącznie 4039 unikalnych wierzchołków oraz 88234 krawędzi. Ilustruje to, jak duże mogą być sumarycznie sieci osobistych kontaktów - średnio pojedynczy uczestnik miał kilkuset znajomych, a między nimi istniało bardzo wiele połączeń. My jednak analizujemy każdą sieć oddzielnie, gdyż są one niezależne (choć w oryginalnym zbiorze zaobserwowano, że niektórzy uczestnicy mieli wspólnych znajomych, przez co ego-sieci nie są całkowicie rozłączne - zdarza się, że jeden wierzchołek należy do dwóch ego-sieci, jeśli dwaj uczestnicy badania byli znajomymi).

Jak wspomniano, z powodu braku węzła \textit{ego} w grafie znajomych większość ego-sieci dzieli się na więcej niż jedną składową spójną. W praktyce zazwyczaj istnieje jedna dominująca komponenta, zawierająca największą grupę wzajemnie powiązanych znajomych, oraz kilka mniejszych komponentów (np. dwu- lub kilkuosobowych grup) odpowiadających odizolowanym kręgom towarzyskim. Dla przykładu, sieć \verb|107.edges| (niewykorzystana u nas ze względu na rozmiar) okazała się całkowicie spójna - wszyscy znajomi użytkownika 107 tworzyli jeden klaster połączony również ze sobą. Natomiast sieć \verb|0.edges| (333 węzły) miała 5 komponentów - co już sygnalizowano wcześniej. Wśród naszych analizowanych sieci: sieć \verb|686.edges| jest spójna (1 komponent), sieć \verb|414.edges| dzieli się na 2 komponenty, sieć \verb|698.edges| na 3, a sieć \verb|3980.edges| na 4 komponenty. Zwykle największy komponent obejmuje zdecydowaną większość wierzchołków (np. w sieci \verb|414.edges| ponad 80\% znajomych należy do jednego klastra, a reszta tworzy małą odrębną grupkę). Taka struktura wskazuje na obecność jednego głównego kręgu znajomych, uzupełnionego kilkoma mniejszymi grupami znajomości niepowiązanych z resztą.

Ego-sieci Facebooka cechują się na ogół wysokim \textit{clusteringiem}, co zgodne jest z intuicją - znajomi konkretnej osoby często znają się nawzajem. W literaturze podaje się, że globalny współczynnik klasteryzacji dla całego grafu Facebooka jest stosunkowo niski, ale wynika to z faktu, że taka metryka obejmuje również połączenia między ludźmi, którzy nie mają żadnych wspólnych znajomych. Natomiast w obrębie pojedynczej ego-sieci (gdzie wszyscy rozważani ludzie są znajomymi jednego \textit{ego}) współczynnik skupienia jest znacznie wyższy. Dla połączonej sieci 10 ego (4039 węzłów) średni \textit{clustering} wynosił aż 0.6055, co oznacza, że dwaj losowo wybrani znajomi danego \textit{ego} mieli ponad 60\% szans, by również być znajomymi między sobą. W naszych mniejszych sieciach wartości te różnią się w zależności od sieci, ale zwykle mieszczą się w przedziale 0.5-0.6 dla największego komponentu (mniejsze komponenty, np. dwuosobowe, mają \textit{clustering} równy 0 lub nieokreślony). Wysoki średni współczynnik skupienia potwierdza istnienie silnych lokalnych powiązań - w grafie występuje wiele trójkątów (grup znajomych, z których każdy zna pozostałych). Przykładowo, jeśli \textit{ego} posiada grupę bliskich przyjaciół ze szkoły, to prawdopodobne jest, że większość z nich zna się nawzajem, tworząc pełne podgrafy (kliki) o dużym \textit{clusteringu}.

Gęstość, rozumiana jako stosunek liczby istniejących krawędzi do maksymalnej liczby krawędzi możliwej między daną liczbą wierzchołków, w ego-sieciach Facebooka jest stosunkowo niska w kategoriach bezwzględnych (co wynika z faktu, że sieci społecznościowe z natury są rzadkie). Jednak gęstość ta bywa wyższa niż w porównywalnie małych grafach generowanych losowo. Dla zobrazowania: jedna z większych ego-sieci (ID 0, 333 węzły) zawierała 5038 krawędzi, co daje gęstość ok. 0.091 (9.1\%) - czyli spośród wszystkich możliwych par znajomych około 9\% par faktycznie łączy relacja. W przypadku sieci 107 (1034 węzły, 26749 krawędzi) gęstość wyniosła ok. 0.05 (5\%). Nasze mniejsze sieci, takie jak 3980 czy 698, mogą mieć nieco wyższe gęstości ze względu na efekt małych grup (jeśli \textit{ego} ma np. 30 znajomych i wszyscy oni się znają nawzajem, to gęstość takiej małej sieci jest bardzo wysoka, bliska 100\%; jednak zwykle nie każdy zna każdego, więc realnie gęstości wynoszą kilkanaście-kilkadziesiąt procent dla bardzo małych sieci i kilka procent dla większych). Ogólnie gęstość maleje wraz ze wzrostem liczby wierzchołków - większe kręgi znajomych rzadziej są kompletnie połączone. W porównaniu do grafów losowych o podobnej skali i liczbie krawędzi, ego-sieci mają wyższy \textit{clustering} (krawędzie nie są rozłożone przypadkowo, lecz skoncentrowane wewnątrz grup), natomiast same wartości gęstości nie odbiegają rzędu wielkościowo - nadal są to grafy rzadkie (rzędu pojedynczych procent). Ta rzadka natura sieci społecznych jest istotna z punktu widzenia testowanych algorytmów, gdyż wiele z nich ma złożoności silnie zależne od liczby krawędzi (np. operacje przeszukiwania grafu lub znajdowania struktur klikowych mogą być szybsze w grafach rzadszych).

% Podsumowując, rzeczywiste dane z \texttt{Facebook Ego Network} dostarczyły cennych przykładów małych sieci społecznych o realnych właściwościach. Dzięki nim możliwe było zweryfikowanie, czy implementowane algorytmy radzą sobie z naturalnymi strukturami takimi jak gęsto połączone kliki znajomych, obecność hubów (np. \textit{ego} jako ukrytego węzła łączącego komponenty) czy rozkłady stopni wierzchołków zbliżone do obserwowanych w realnych sieciach. Analiza tych sieci pozwoliła również porównać wyniki z danymi syntetycznymi - sprawdzić, na ile modele generatywne (ER, BA, WS) oddają cechy zaobserwowane w prawdziwych sieciach. W dalszych rozdziałach, przy omawianiu wyników eksperymentów, będziemy odwoływać się do opisanych tu zbiorów danych testowych.
